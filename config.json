{
  "paths": {
    "raw_data_dir": "data/raw",
    "processed_data_dir": "data/processed",
    "processed_dir": "data/processed",
    "work_dir": "models/v2"
  },
  "system": {
    "seed": 1234,
    "log_level": "INFO",
    "device": "auto"
  },
  "data": {
    "species_variables": [
      "H_evolution",
      "H2_evolution",
      "OH_evolution",
      "H2O_evolution",
      "CO_evolution",
      "CO2_evolution",
      "O_evolution",
      "CH4_evolution",
      "C2H2_evolution",
      "NH3_evolution",
      "N2_evolution",
      "HCN_evolution"],
    "global_variables": ["P", "T"]
  },
  "normalization": {
    "epsilon": 1e-30,
    "min_std": 1e-12,
    "methods": {
      "P": "log-min-max",
      "T": "min-max"
    },
    "default_method": "log-standard",
    "globals_default_method": "standard"
  },
  "preprocessing": {
    "dt": 100.0,
    "dt_mode": "per_chunk",
    "dt_min": 5e-2,
    "dt_max": 5e3,
    "dt_sampling": "loguniform",
    "n_steps": 500,
    "t_min": 0.0,
    "drop_below": 1e-30,
    "output_trajectories_per_file": 10000,
    "shard_size": 8192,
    "overwrite": true,
    "time_keys": ["t_time", "time", "t"],
    "time_key": null,
    "species_group": null,
    "globals_group": null,
    "val_fraction": 0.1,
    "test_fraction": 0.1,
    "seed": 1234,
    "pool_size": 1000000,
    "samples_per_source_trajectory": 100,
    "max_chunk_attempts_per_source": 200,
    "raw_file_patterns": ["*.h5", "*.hdf5"],
    "_comment": {
      "dt": "Nominal timestep (seconds). Used directly when dt_mode='fixed'.",
      "dt_mode": "How dt is chosen: 'fixed' => always dt; 'per_chunk' => sample one dt per chunk.",
      "dt_min": "Minimum dt (seconds) when dt_mode='per_chunk'; ignored/overwritten in 'fixed'.",
      "dt_max": "Maximum dt (seconds) when dt_mode='per_chunk'; ignored/overwritten in 'fixed'.",
      "dt_sampling": "Distribution for per-chunk dt: 'uniform' (linear) or 'loguniform' (log10-uniform).",
      "n_steps": "Steps per sampled chunk; chunk duration ~ n_steps * dt (after any regridding).",
      "t_min": "Avoid/discard times < t_min when building chunks (skips very-early tiny times).",
      "drop_below": "Reject values below this",
      "output_trajectories_per_file": "Target # output trajectories per produced file (controls file splitting).",
      "shard_size": "Samples per output shard on disk (affects dataset IO and caching).",
      "overwrite": "If true, replace existing processed outputs instead of erroring.",
      "time_keys": "Candidate dataset names to find the time array if time_key is not set.",
      "time_key": "If set, force this exact time dataset name (bypasses time_keys search).",
      "species_group": "If set, HDF5 group path containing species datasets; null => infer/use root.",
      "globals_group": "If set, HDF5 group path containing globals datasets; null => infer/use root.",
      "val_fraction": "Fraction of processed chunks assigned to validation split.",
      "test_fraction": "Fraction of processed chunks assigned to test split (train is remainder).",
      "seed": "RNG seed for preprocessing sampling/splitting (defaults to system.seed if omitted).",
      "pool_size": "Size of candidate sampling pool used when drawing chunks from source trajectories.",
      "samples_per_source_trajectory": "How many chunks to sample from each source trajectory.",
      "max_chunk_attempts_per_source": "Max resampling tries per source to find a valid chunk.",
      "raw_file_patterns": "Glob patterns used to find raw input files under paths.raw_data_dir."
    }
  },
  "dataset": {
    "windows_per_trajectory": 100,
    "preload_to_device": true,
    "shard_cache_size": 2,
    "use_mmap": true
  },
  "model": {
    "type": "mlp",
    "activation": "silu",
    "dropout": 0.00,
    "predict_delta": true,
    "layer_norm": true,
    "layer_norm_eps": 1e-05,
    "mlp": {
      "hidden_dims": [2048, 2048, 2048, 2048, 2048, 2048, 2048, 2048],
      "residual": true
    },
    "autoencoder": {
      "latent_dim": 256,
      "encoder_hidden": [512, 512],
      "dynamics_hidden": [512, 512],
      "decoder_hidden": [512, 512],
      "residual": true,
      "dynamics_residual": true
    }
  },
  "training": {
    "max_epochs": 1000,
    "rollout_steps": 1,
    "batch_size": 8192,
    "num_workers": 0,
    "pin_memory": false,
    "persistent_workers": false,
    "prefetch_factor": null,
    "checkpoint_mode": "none",
    "loss": {
      "lambda_log10_mae": 1.0,
      "lambda_z_mse": 0.1
    },
    "optimizer": {
      "name": "adamw",
      "lr": 0.0001,
      "weight_decay": 0.0001,
      "betas": [0.9, 0.999],
      "eps": 1e-08,
      "exclude_norm_and_bias_from_weight_decay": true,
      "fused": true,
      "foreach": false
    },
    "scheduler": {
      "enabled": true,
      "type": "cosine_with_warmup",
      "warmup_epochs": 50,
      "min_lr_ratio": 0.01,
      "factor": 0.5,
      "patience": 10,
      "threshold": 0.0001,
      "min_lr": 1e-07,
      "mode": "min",
      "monitor": "val_loss"
    },
    "autoregressive_training": {
      "enabled": false,
      "skip_steps": 0,
      "detach_between_steps": true,
      "backward_per_step": true
    },
    "curriculum": {
      "enabled": false,
      "mode": "linear",
      "ramp_epochs": 0,
      "start_steps": 1,
      "end_steps": 1
    }
  },
  "runtime": {
    "mode": "train",
    "checkpoint": null,
    "load_weights_strict": true,
    "devices": "auto",
    "accelerator": "auto",
    "strategy": "auto",
    "precision": "bf16-mixed",
    "log_every_n_steps": 50,
    "enable_progress_bar": false,
    "gradient_clip_val": null,
    "accumulate_grad_batches": 1,
    "deterministic": false,
    "checkpointing": {
      "enabled": true,
      "every_n_epochs": 1,
      "save_top_k": 1,
      "monitor": "val_loss"
    },
    "torch_compile": {
      "enabled": true,
      "backend": "inductor",
      "mode": "reduce-overhead",
      "dynamic": false,
      "fullgraph": true,
      "compile_forward_step": true,
      "compile_open_loop_unroll": false
    }
  }
}